<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Inventory Management System</title>
  <style>
    :root{
      --bg:#0b1020;
      --panel:#111a33;
      --panel2:#0f1730;
      --text:#e9efff;
      --muted:#aab6df;
      --brand:#6aa6ff;
      --ok:#3ddc97;
      --warn:#ffcc66;
      --bad:#ff6b6b;
      --line:rgba(255,255,255,.08);
      --shadow: 0 8px 24px rgba(0,0,0,.35);
      --radius: 16px;
      --radius2: 12px;
      --font: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial;
    }
    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0;
      font-family:var(--font);
      background: radial-gradient(1200px 800px at 20% -10%, rgba(106,166,255,.25), transparent 55%),
                  radial-gradient(1000px 700px at 110% 30%, rgba(61,220,151,.10), transparent 55%),
                  var(--bg);
      color:var(--text);
    }
    a{color:inherit}
    .app{
      display:grid;
      grid-template-columns: 280px 1fr;
      min-height:100vh;
    }
    .sidebar{
      background: linear-gradient(180deg, rgba(255,255,255,.03), transparent 30%),
                  var(--panel2);
      border-right: 1px solid var(--line);
      padding: 18px 14px;
      position: sticky;
      top:0;
      height: 100vh;
      overflow:auto;
    }
    .brand{
      display:flex;
      align-items:center;
      gap:12px;
      padding:10px 10px 14px;
      margin-bottom: 10px;
    }
    .logo{
      width:42px;height:42px;border-radius:14px;
      background: linear-gradient(135deg, rgba(106,166,255,.9), rgba(61,220,151,.6));
      box-shadow: var(--shadow);
    }
    .brand h1{
      font-size: 16px; margin:0; letter-spacing:.2px;
    }
    .brand p{
      margin:2px 0 0; font-size:12px; color:var(--muted);
    }
    .nav{
      display:flex;
      flex-direction:column;
      gap:6px;
      padding: 8px;
    }
    .nav button{
      display:flex;
      align-items:center;
      gap:10px;
      width:100%;
      border:1px solid transparent;
      background: transparent;
      color: var(--text);
      padding: 10px 12px;
      border-radius: 12px;
      cursor:pointer;
      text-align:left;
      transition:.12s ease;
      font-size:14px;
    }
    .nav button:hover{ background: rgba(255,255,255,.04); }
    .nav button.active{
      background: rgba(106,166,255,.13);
      border-color: rgba(106,166,255,.25);
    }
    .nav .icon{ width:22px; opacity:.95; display:inline-flex; justify-content:center; }
    .side-footer{
      margin-top: 16px;
      padding: 12px;
      border-top:1px solid var(--line);
      color:var(--muted);
      font-size:12px;
    }
    .main{
      padding: 22px 22px 40px;
      overflow:auto;
    }
    .topbar{
      display:flex;
      flex-wrap:wrap;
      align-items:center;
      justify-content:space-between;
      gap:12px;
      margin-bottom: 16px;
    }
    .title h2{margin:0;font-size:20px}
    .title p{margin:4px 0 0;color:var(--muted);font-size:13px}
    .actions{
      display:flex; gap:10px; flex-wrap:wrap; align-items:center;
    }
    .search{
      display:flex; align-items:center; gap:10px;
      background: rgba(255,255,255,.04);
      border:1px solid var(--line);
      padding: 10px 12px;
      border-radius: 999px;
      min-width: 280px;
    }
    .search input{
      width:100%;
      border:none;
      outline:none;
      background: transparent;
      color: var(--text);
      font-size: 14px;
    }
    .btn{
      border:1px solid var(--line);
      background: rgba(255,255,255,.04);
      color: var(--text);
      padding: 10px 12px;
      border-radius: 12px;
      cursor:pointer;
      transition:.12s ease;
      font-weight:600;
      font-size: 13px;
    }
    .btn:hover{ background: rgba(255,255,255,.06); }
    .btn.primary{
      background: rgba(106,166,255,.18);
      border-color: rgba(106,166,255,.28);
    }
    .btn.primary:hover{ background: rgba(106,166,255,.24); }
    .btn.danger{
      background: rgba(255,107,107,.12);
      border-color: rgba(255,107,107,.20);
    }
    .btn.ghost{
      background: transparent;
    }
    .grid{
      display:grid;
      grid-template-columns: 1.2fr .8fr;
      gap: 14px;
      align-items:start;
    }
    .card{
      background: linear-gradient(180deg, rgba(255,255,255,.03), transparent 26%),
                  rgba(255,255,255,.02);
      border: 1px solid var(--line);
      border-radius: var(--radius);
      box-shadow: 0 10px 32px rgba(0,0,0,.28);
      overflow:hidden;
    }
    .card .hd{
      padding: 14px 14px 10px;
      border-bottom: 1px solid var(--line);
      display:flex; align-items:center; justify-content:space-between; gap:10px;
    }
    .card .hd h3{margin:0;font-size:14px}
    .card .hd .sub{color:var(--muted);font-size:12px}
    .card .bd{padding: 14px}
    .kpi-row{
      display:grid;
      grid-template-columns: repeat(3, 1fr);
      gap: 12px;
      margin-bottom: 14px;
    }
    .kpi{
      background: rgba(255,255,255,.03);
      border:1px solid var(--line);
      border-radius: 14px;
      padding: 12px;
    }
    .kpi .label{color:var(--muted);font-size:12px}
    .kpi .value{font-size:20px;font-weight:800;margin-top:6px}
    .badge{
      display:inline-flex;
      align-items:center;
      gap:6px;
      padding: 5px 10px;
      border-radius: 999px;
      border: 1px solid var(--line);
      font-size: 12px;
      color: var(--muted);
      background: rgba(255,255,255,.03);
    }
    .badge.ok{ color: rgba(61,220,151,.95); border-color: rgba(61,220,151,.25); background: rgba(61,220,151,.08);}
    .badge.warn{ color: rgba(255,204,102,.98); border-color: rgba(255,204,102,.22); background: rgba(255,204,102,.08);}
    .badge.bad{ color: rgba(255,107,107,.98); border-color: rgba(255,107,107,.22); background: rgba(255,107,107,.08);}

    table{
      width:100%;
      border-collapse:collapse;
      font-size: 13px;
    }
    th,td{
      padding: 10px 8px;
      border-bottom: 1px solid var(--line);
      vertical-align:middle;
    }
    th{
      text-align:left;
      color: var(--muted);
      font-weight: 700;
      font-size: 12px;
      letter-spacing:.2px;
    }
    tr:hover td{ background: rgba(255,255,255,.02); }
    .row-actions{
      display:flex; gap:6px; justify-content:flex-end;
    }
    .mini{
      padding: 7px 9px;
      border-radius: 10px;
      font-size: 12px;
    }
    .muted{ color: var(--muted); }
    .two-col{
      display:grid;
      grid-template-columns: 1fr 1fr;
      gap: 10px;
    }
    .field{
      display:flex;
      flex-direction:column;
      gap:6px;
      margin-bottom: 10px;
    }
    .field label{
      font-size: 12px;
      color: var(--muted);
      font-weight: 700;
    }
    .field input, .field select, .field textarea{
      background: rgba(255,255,255,.03);
      border: 1px solid var(--line);
      color: var(--text);
      padding: 10px 10px;
      border-radius: 12px;
      outline:none;
      font-size: 14px;
    }
    .field textarea{ min-height: 80px; resize: vertical; }
    .hint{ color: var(--muted); font-size: 12px; margin-top: 2px; }
    .line-items{
      display:flex;
      flex-direction:column;
      gap:10px;
    }
    .li{
      border:1px solid var(--line);
      border-radius: 14px;
      padding: 10px;
      background: rgba(255,255,255,.02);
      display:grid;
      grid-template-columns: 1.2fr .5fr .5fr auto;
      gap: 8px;
      align-items:end;
    }
    .li .field{ margin-bottom: 0; }
    .li .remove{ justify-self:end; }
    .toast{
      position: fixed;
      right: 18px;
      bottom: 18px;
      background: rgba(17,26,51,.92);
      border: 1px solid var(--line);
      border-radius: 14px;
      padding: 12px 12px;
      box-shadow: var(--shadow);
      max-width: 360px;
      display:none;
      z-index: 9999;
    }
    .toast.show{display:block}
    .toast .t{font-weight:800;margin:0 0 4px}
    .toast .m{margin:0;color:var(--muted);font-size:13px}
    .empty{
      padding: 14px;
      border: 1px dashed rgba(255,255,255,.18);
      border-radius: 14px;
      color: var(--muted);
      background: rgba(255,255,255,.02);
      font-size: 13px;
    }
    .split{
      display:flex; gap:10px; flex-wrap:wrap; align-items:center;
    }
    .right{ text-align:right; }
    .pill{
      display:inline-flex; gap:8px; align-items:center;
      padding: 8px 10px;
      border-radius: 999px;
      border: 1px solid var(--line);
      background: rgba(255,255,255,.02);
      color: var(--muted);
      font-size: 12px;
    }
    .hr{ height:1px; background: var(--line); margin: 12px 0; }
    @media (max-width: 980px){
      .app{ grid-template-columns: 1fr; }
      .sidebar{ position:relative; height:auto; }
      .grid{ grid-template-columns: 1fr; }
      .search{ min-width: 200px; flex: 1; }
      .kpi-row{ grid-template-columns: 1fr; }
    }
  </style>
</head>
<body>
<div class="app">
  <aside class="sidebar">
    <div class="brand">
      <div class="logo"></div>
      <div>
        <h1>Inventory System</h1>
        <p>Supply ‚Ä¢ Sell ‚Ä¢ Manage</p>
      </div>
    </div>

    <div class="nav" id="nav">
      <button data-view="dashboard" class="active"><span class="icon">üè†</span>Dashboard</button>
      <button data-view="inventory"><span class="icon">üì¶</span>Inventory</button>
      <button data-view="clients"><span class="icon">üë•</span>Clients</button>
      <button data-view="vendors"><span class="icon">üè≠</span>Vendors</button>
      <button data-view="supply"><span class="icon">‚¨áÔ∏è</span>Supply Orders</button>
      <button data-view="sales"><span class="icon">‚¨ÜÔ∏è</span>Sales</button>
      <button data-view="reports"><span class="icon">üìà</span>Reports</button>
    </div>

    <div class="side-footer">
      <div class="split">
        <span class="pill">Demo Mode</span>
        <span class="pill" id="dbStatus">SQLite Ready</span>
      </div>
      <div style="margin-top:10px;">
        Tip: Try "Supply Orders" then "Sales"
      </div>
    </div>
  </aside>

  <main class="main">
    <div class="topbar">
      <div class="title">
        <h2 id="pageTitle">Dashboard</h2>
        <p id="pageSubtitle" class="muted">Overview at a glance</p>
      </div>

      <div class="actions">
        <div class="search">
          <span style="opacity:.85">üîé</span>
          <input id="globalSearch" placeholder="Search inventory..." />
        </div>
        <button class="btn" id="seedBtn" title="Load demo data">Load Demo</button>
        <button class="btn danger" id="resetBtn" title="Clear all data">Reset</button>
      </div>
    </div>

    <div id="view"></div>
  </main>
</div>

<div class="toast" id="toast">
  <p class="t" id="toastTitle">Saved</p>
  <p class="m" id="toastMsg">Done.</p>
</div>

<script>
// ===================================================================
// DEMO DATA STORE (In-Memory Simulation of SQLite Database)
// ===================================================================
// NOTE: This frontend is designed to work with your SQLite schema
// For production, replace these functions with actual SQLite queries
// ===================================================================

const DB = {
  inventory: [],
  clients: [],
  vendors: [],
  sales: [],
  sale_items: [],
  supply_orders: [],
  supply_items: []
};

let nextId = {
  item: 1,
  client: 1,
  vendor: 1,
  sale: 1,
  sale_item: 1,
  supply_order: 1,
  supply_item: 1
};

// Utility functions
function money(n) {
  const x = Number(n || 0);
  return x.toLocaleString(undefined, {minimumFractionDigits: 2, maximumFractionDigits: 2});
}

function safeInt(v, fallback = 0) {
  const n = Number.parseInt(v, 10);
  return Number.isFinite(n) ? n : fallback;
}

function safeFloat(v, fallback = 0) {
  const n = Number.parseFloat(v);
  return Number.isFinite(n) ? n : fallback;
}

function nowISO() {
  return new Date().toISOString();
}

function formatWhen(iso) {
  const d = new Date(iso);
  return d.toLocaleString(undefined, {year:"numeric", month:"short", day:"2-digit", hour:"2-digit", minute:"2-digit"});
}

function esc(s) {
  return String(s ?? "").replace(/[&<>"']/g, c => ({
    "&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#039;"
  }[c]));
}

// ===================================================================
// DATABASE OPERATIONS (Simulating SQLite)
// ===================================================================

// Inventory operations
function getInventory() {
  return DB.inventory.sort((a, b) => a.item_name.localeCompare(b.item_name));
}

function getInventoryById(id) {
  return DB.inventory.find(i => i.item_id === id);
}

function addInventoryItem(item) {
  const newItem = {
    item_id: nextId.item++,
    item_name: item.item_name,
    description: item.description || null,
    quantity: item.quantity || 0,
    unit_price: item.unit_price,
    reorder_level: item.reorder_level || 10,
    notes: item.notes || null,
    created_date: nowISO()
  };
  DB.inventory.push(newItem);
  return newItem;
}

function updateInventoryItem(id, updates) {
  const item = getInventoryById(id);
  if (!item) return null;
  Object.assign(item, updates);
  return item;
}

function deleteInventoryItem(id) {
  const idx = DB.inventory.findIndex(i => i.item_id === id);
  if (idx >= 0) DB.inventory.splice(idx, 1);
}

// Client operations
function getClients() {
  return DB.clients.sort((a, b) => a.client_name.localeCompare(b.client_name));
}

function getClientById(id) {
  return DB.clients.find(c => c.client_id === id);
}

function addClient(client) {
  const newClient = {
    client_id: nextId.client++,
    client_name: client.client_name,
    email: client.email || null,
    phone: client.phone || null,
    address: client.address || null,
    notes: client.notes || null,
    created_date: nowISO()
  };
  DB.clients.push(newClient);
  return newClient;
}

function updateClient(id, updates) {
  const client = getClientById(id);
  if (!client) return null;
  Object.assign(client, updates);
  return client;
}

function deleteClient(id) {
  const idx = DB.clients.findIndex(c => c.client_id === id);
  if (idx >= 0) DB.clients.splice(idx, 1);
}

// Vendor operations
function getVendors() {
  return DB.vendors.sort((a, b) => a.vendor_name.localeCompare(b.vendor_name));
}

function getVendorById(id) {
  return DB.vendors.find(v => v.vendor_id === id);
}

function addVendor(vendor) {
  const newVendor = {
    vendor_id: nextId.vendor++,
    vendor_name: vendor.vendor_name,
    email: vendor.email || null,
    phone: vendor.phone || null,
    address: vendor.address || null,
    notes: vendor.notes || null,
    created_date: nowISO()
  };
  DB.vendors.push(newVendor);
  return newVendor;
}

function updateVendor(id, updates) {
  const vendor = getVendorById(id);
  if (!vendor) return null;
  Object.assign(vendor, updates);
  return vendor;
}

function deleteVendor(id) {
  const idx = DB.vendors.findIndex(v => v.vendor_id === id);
  if (idx >= 0) DB.vendors.splice(idx, 1);
}

// Supply order operations
function createSupplyOrder(order) {
  const newOrder = {
    supply_order_id: nextId.supply_order++,
    vendor_id: order.vendor_id || null,
    order_date: nowISO(),
    notes: order.notes || null
  };
  DB.supply_orders.push(newOrder);

  // Add supply items and update inventory
  for (const item of order.items) {
    const supplyItem = {
      supply_item_id: nextId.supply_item++,
      supply_order_id: newOrder.supply_order_id,
      item_id: item.item_id,
      quantity: item.quantity,
      cost_price: item.cost_price,
      notes: item.notes || null
    };
    DB.supply_items.push(supplyItem);

    // Trigger: Update inventory
    const invItem = getInventoryById(item.item_id);
    if (invItem) {
      invItem.quantity += item.quantity;
    }
  }

  return newOrder;
}

function getSupplyOrders() {
  return DB.supply_orders.sort((a, b) => b.order_date.localeCompare(a.order_date));
}

function getSupplyOrderDetails(orderId) {
  const items = DB.supply_items.filter(si => si.supply_order_id === orderId);
  return items.map(si => {
    const item = getInventoryById(si.item_id);
    const order = DB.supply_orders.find(o => o.supply_order_id === orderId);
    const vendor = order?.vendor_id ? getVendorById(order.vendor_id) : null;
    return {
      ...si,
      item_name: item?.item_name,
      vendor_name: vendor?.vendor_name,
      order_date: order?.order_date,
      subtotal: si.quantity * si.cost_price
    };
  });
}

// Sales operations
function createSale(sale) {
  // Check inventory availability first
  for (const item of sale.items) {
    const invItem = getInventoryById(item.item_id);
    if (!invItem || invItem.quantity < item.quantity) {
      throw new Error(`Insufficient stock for ${invItem?.item_name || 'item'}`);
    }
  }

  const newSale = {
    sale_id: nextId.sale++,
    client_id: sale.client_id || null,
    sale_date: nowISO(),
    notes: sale.notes || null
  };
  DB.sales.push(newSale);

  // Add sale items and update inventory
  for (const item of sale.items) {
    const saleItem = {
      sale_item_id: nextId.sale_item++,
      sale_id: newSale.sale_id,
      item_id: item.item_id,
      quantity: item.quantity,
      unit_price: item.unit_price,
      notes: item.notes || null
    };
    DB.sale_items.push(saleItem);

    // Trigger: Update inventory
    const invItem = getInventoryById(item.item_id);
    if (invItem) {
      invItem.quantity -= item.quantity;
    }
  }

  return newSale;
}

function getSales() {
  return DB.sales.sort((a, b) => b.sale_date.localeCompare(a.sale_date));
}

function getSaleDetails(saleId) {
  const items = DB.sale_items.filter(si => si.sale_id === saleId);
  return items.map(si => {
    const item = getInventoryById(si.item_id);
    const sale = DB.sales.find(s => s.sale_id === saleId);
    const client = sale?.client_id ? getClientById(sale.client_id) : null;
    return {
      ...si,
      item_name: item?.item_name,
      client_name: client?.client_name,
      sale_date: sale?.sale_date,
      subtotal: si.quantity * si.unit_price
    };
  });
}

// View: Low stock items
function getLowStockItems() {
  return DB.inventory
    .filter(i => i.quantity <= i.reorder_level)
    .sort((a, b) => a.quantity - b.quantity);
}

// ===================================================================
// UI HELPER FUNCTIONS
// ===================================================================

const viewEl = document.getElementById("view");
const pageTitle = document.getElementById("pageTitle");
const pageSubtitle = document.getElementById("pageSubtitle");

function setPage(title, subtitle) {
  pageTitle.textContent = title;
  pageSubtitle.textContent = subtitle || "";
}

const toastEl = document.getElementById("toast");
function toast(title, msg) {
  document.getElementById("toastTitle").textContent = title;
  document.getElementById("toastMsg").textContent = msg;
  toastEl.classList.add("show");
  setTimeout(() => toastEl.classList.remove("show"), 2400);
}

function badgeForStock(q, threshold) {
  if (threshold == null) return `<span class="badge">Stock ${q}</span>`;
  if (q <= 0) return `<span class="badge bad">Out (${q})</span>`;
  if (q <= threshold) return `<span class="badge warn">Low (${q})</span>`;
  return `<span class="badge ok">OK (${q})</span>`;
}

// ===================================================================
// VIEW RENDERERS
// ===================================================================

function renderDashboard() {
  setPage("Dashboard", "Overview at a glance");
  
  const lowStock = getLowStockItems();
  const recentSales = getSales().slice(0, 5);
  const recentSupply = getSupplyOrders().slice(0, 5);
  
  const totalValue = DB.inventory.reduce((sum, i) => sum + (i.quantity * i.unit_price), 0);
  const totalItems = DB.inventory.reduce((sum, i) => sum + i.quantity, 0);

  viewEl.innerHTML = `
    <div class="kpi-row">
      <div class="kpi">
        <div class="label">Total Inventory Value</div>
        <div class="value">‚Ç¨${money(totalValue)}</div>
      </div>
      <div class="kpi">
        <div class="label">Total Items in Stock</div>
        <div class="value">${totalItems}</div>
      </div>
      <div class="kpi">
        <div class="label">Low Stock Alerts</div>
        <div class="value">${lowStock.length}</div>
      </div>
    </div>

    <div class="grid">
      <div class="card">
        <div class="hd">
          <div>
            <h3>Low Stock Items</h3>
            <div class="sub">Items at or below reorder level</div>
          </div>
          <button class="btn mini primary" onclick="goto('inventory')">View All</button>
        </div>
        <div class="bd">
          ${lowStock.length ? `
            <table>
              <thead>
                <tr>
                  <th>Item</th>
                  <th>Quantity</th>
                  <th>Reorder Level</th>
                </tr>
              </thead>
              <tbody>
                ${lowStock.slice(0, 5).map(item => `
                  <tr>
                    <td><strong>${esc(item.item_name)}</strong></td>
                    <td>${badgeForStock(item.quantity, item.reorder_level)}</td>
                    <td class="muted">${item.reorder_level}</td>
                  </tr>
                `).join("")}
              </tbody>
            </table>
          ` : `<div class="empty">No low stock alerts</div>`}
        </div>
      </div>

      <div class="card">
        <div class="hd">
          <div>
            <h3>Recent Activity</h3>
            <div class="sub">Latest transactions</div>
          </div>
        </div>
        <div class="bd">
          <h4 style="margin:0 0 8px;font-size:13px;color:var(--muted)">Recent Sales</h4>
          ${recentSales.length ? `
            <table style="margin-bottom:16px">
              <tbody>
                ${recentSales.map(sale => {
                  const client = sale.client_id ? getClientById(sale.client_id) : null;
                  return `
                    <tr>
                      <td class="muted" style="font-size:11px">${formatWhen(sale.sale_date)}</td>
                      <td>${client ? esc(client.client_name) : "Walk-in"}</td>
                    </tr>
                  `;
                }).join("")}
              </tbody>
            </table>
          ` : `<div class="empty" style="margin-bottom:16px">No sales yet</div>`}
          
          <h4 style="margin:0 0 8px;font-size:13px;color:var(--muted)">Recent Supply Orders</h4>
          ${recentSupply.length ? `
            <table>
              <tbody>
                ${recentSupply.map(order => {
                  const vendor = order.vendor_id ? getVendorById(order.vendor_id) : null;
                  return `
                    <tr>
                      <td class="muted" style="font-size:11px">${formatWhen(order.order_date)}</td>
                      <td>${vendor ? esc(vendor.vendor_name) : "‚Äî"}</td>
                    </tr>
                  `;
                }).join("")}
              </tbody>
            </table>
          ` : `<div class="empty">No supply orders yet</div>`}
        </div>
      </div>
    </div>
  `;
}

function renderInventory(filter = "") {
  setPage("Inventory", "Manage your products");
  const q = filter.trim().toLowerCase();
  
  const items = getInventory().filter(i => {
    if (!q) return true;
    return i.item_name.toLowerCase().includes(q) || (i.description || "").toLowerCase().includes(q);
  });

  viewEl.innerHTML = `
    <div class="grid">
      <div class="card">
        <div class="hd">
          <div>
            <h3>All Items</h3>
            <div class="sub">${items.length} items</div>
          </div>
          <button class="btn primary mini" id="addItemBtn">+ Add Item</button>
        </div>
        <div class="bd">
          ${items.length ? `
            <table>
              <thead>
                <tr>
                  <th>Item</th>
                  <th class="right">Quantity</th>
                  <th class="right">Unit Price</th>
                  <th class="right">Actions</th>
                </tr>
              </thead>
              <tbody>
                ${items.map(item => `
                  <tr>
                    <td>
                      <div style="font-weight:800">${esc(item.item_name)}</div>
                      <div class="muted" style="font-size:12px">${esc(item.description || "")}</div>
                    </td>
                    <td class="right">${badgeForStock(item.quantity, item.reorder_level)}</td>
                    <td class="right muted">‚Ç¨${money(item.unit_price)}</td>
                    <td class="right">
                      <div class="row-actions">
                        <button class="btn mini" onclick="editItem(${item.item_id})">Edit</button>
                        <button class="btn mini danger" onclick="deleteItem(${item.item_id})">Delete</button>
                      </div>
                    </td>
                  </tr>
                `).join("")}
              </tbody>
            </table>
          ` : `<div class="empty">No items found</div>`}
        </div>
      </div>

      <div class="card">
        <div class="hd">
          <h3 id="itemFormTitle">Add Item</h3>
        </div>
        <div class="bd">
          <form id="itemForm">
            <input type="hidden" id="if_id" />
            <div class="field">
              <label>Item Name *</label>
              <input id="if_name" required placeholder="e.g., Coffee Beans 1kg" />
            </div>
            <div class="field">
              <label>Description</label>
              <textarea id="if_desc" placeholder="Optional description"></textarea>
            </div>
            <div class="two-col">
              <div class="field">
                <label>Unit Price *</label>
                <input id="if_price" type="number" min="0" step="0.01" required placeholder="e.g., 12.50" />
              </div>
              <div class="field">
                <label>Reorder Level</label>
                <input id="if_reorder" type="number" min="0" step="1" placeholder="e.g., 10" />
              </div>
            </div>
            <div class="field">
              <label>Notes</label>
              <input id="if_notes" placeholder="Optional notes" />
            </div>
            
            <div class="split" style="justify-content:flex-end; margin-top:10px;">
              <button type="button" class="btn ghost" id="if_cancel" style="display:none;">Cancel</button>
              <button class="btn primary" type="submit">Save Item</button>
            </div>
          </form>
        </div>
      </div>
    </div>
  `;

  document.getElementById("addItemBtn").onclick = startAddItem;
  hookItemForm();
}

function startAddItem() {
  document.getElementById("itemFormTitle").textContent = "Add Item";
  document.getElementById("if_id").value = "";
  document.getElementById("if_name").value = "";
  document.getElementById("if_desc").value = "";
  document.getElementById("if_price").value = "";
  document.getElementById("if_reorder").value = "10";
  document.getElementById("if_notes").value = "";
  document.getElementById("if_cancel").style.display = "none";
}

function editItem(id) {
  const item = getInventoryById(id);
  if (!item) return;
  document.getElementById("itemFormTitle").textContent = "Edit Item";
  document.getElementById("if_id").value = item.item_id;
  document.getElementById("if_name").value = item.item_name;
  document.getElementById("if_desc").value = item.description || "";
  document.getElementById("if_price").value = item.unit_price;
  document.getElementById("if_reorder").value = item.reorder_level;
  document.getElementById("if_notes").value = item.notes || "";
  document.getElementById("if_cancel").style.display = "inline-flex";
}

function deleteItem(id) {
  if (!confirm("Delete this item?")) return;
  deleteInventoryItem(id);
  toast("Deleted", "Item removed");
  renderInventory(document.getElementById("globalSearch").value);
}

function hookItemForm() {
  const form = document.getElementById("itemForm");
  const cancel = document.getElementById("if_cancel");
  cancel.onclick = startAddItem;

  form.onsubmit = (e) => {
    e.preventDefault();
    const id = safeInt(document.getElementById("if_id").value, 0);
    const name = document.getElementById("if_name").value.trim();
    const desc = document.getElementById("if_desc").value.trim();
    const price = safeFloat(document.getElementById("if_price").value, 0);
    const reorder = safeInt(document.getElementById("if_reorder").value, 10);
    const notes = document.getElementById("if_notes").value.trim();

    if (!name || price <= 0) {
      toast("Error", "Item name and valid price required");
      return;
    }

    if (id) {
      updateInventoryItem(id, {
        item_name: name,
        description: desc || null,
        unit_price: price,
        reorder_level: reorder,
        notes: notes || null
      });
      toast("Updated", "Item saved");
    } else {
      addInventoryItem({
        item_name: name,
        description: desc || null,
        quantity: 0,
        unit_price: price,
        reorder_level: reorder,
        notes: notes || null
      });
      toast("Created", "New item added");
    }

    renderInventory(document.getElementById("globalSearch").value);
    setTimeout(startAddItem, 50);
  };
}

function renderClients() {
  setPage("Clients", "Manage your customers");
  const clients = getClients();

  viewEl.innerHTML = `
    <div class="grid">
      <div class="card">
        <div class="hd">
          <div>
            <h3>All Clients</h3>
            <div class="sub">${clients.length} clients</div>
          </div>
          <button class="btn primary mini" id="addClientBtn">+ Add Client</button>
        </div>
        <div class="bd">
          ${clients.length ? `
            <table>
              <thead>
                <tr>
                  <th>Name</th>
                  <th>Contact</th>
                  <th class="right">Actions</th>
                </tr>
              </thead>
              <tbody>
                ${clients.map(c => `
                  <tr>
                    <td>
                      <div style="font-weight:800">${esc(c.client_name)}</div>
                      <div class="muted" style="font-size:12px">${esc(c.notes || "")}</div>
                    </td>
                    <td class="muted">
                      ${c.email ? esc(c.email) : ""}
                      ${c.phone ? " ‚Ä¢ " + esc(c.phone) : ""}
                    </td>
                    <td class="right">
                      <div class="row-actions">
                        <button class="btn mini" onclick="editClient(${c.client_id})">Edit</button>
                        <button class="btn mini danger" onclick="deleteClient_UI(${c.client_id})">Delete</button>
                      </div>
                    </td>
                  </tr>
                `).join("")}
              </tbody>
            </table>
          ` : `<div class="empty">No clients yet</div>`}
        </div>
      </div>

      <div class="card">
        <div class="hd">
          <h3 id="clientFormTitle">Add Client</h3>
        </div>
        <div class="bd">
          <form id="clientForm">
            <input type="hidden" id="cf_id" />
            <div class="field">
              <label>Client Name *</label>
              <input id="cf_name" required placeholder="e.g., Acme Corp" />
            </div>
            <div class="two-col">
              <div class="field">
                <label>Email</label>
                <input id="cf_email" type="email" placeholder="contact@acme.com" />
              </div>
              <div class="field">
                <label>Phone</label>
                <input id="cf_phone" placeholder="+31 20 123 4567" />
              </div>
            </div>
            <div class="field">
              <label>Address</label>
              <input id="cf_address" placeholder="Street, City, Country" />
            </div>
            <div class="field">
              <label>Notes</label>
              <textarea id="cf_notes" placeholder="Optional notes"></textarea>
            </div>
            
            <div class="split" style="justify-content:flex-end; margin-top:10px;">
              <button type="button" class="btn ghost" id="cf_cancel" style="display:none;">Cancel</button>
              <button class="btn primary" type="submit">Save Client</button>
            </div>
          </form>
        </div>
      </div>
    </div>
  `;

  document.getElementById("addClientBtn").onclick = startAddClient;
  hookClientForm();
}

function startAddClient() {
  document.getElementById("clientFormTitle").textContent = "Add Client";
  document.getElementById("cf_id").value = "";
  document.getElementById("cf_name").value = "";
  document.getElementById("cf_email").value = "";
  document.getElementById("cf_phone").value = "";
  document.getElementById("cf_address").value = "";
  document.getElementById("cf_notes").value = "";
  document.getElementById("cf_cancel").style.display = "none";
}

function editClient(id) {
  const client = getClientById(id);
  if (!client) return;
  document.getElementById("clientFormTitle").textContent = "Edit Client";
  document.getElementById("cf_id").value = client.client_id;
  document.getElementById("cf_name").value = client.client_name;
  document.getElementById("cf_email").value = client.email || "";
  document.getElementById("cf_phone").value = client.phone || "";
  document.getElementById("cf_address").value = client.address || "";
  document.getElementById("cf_notes").value = client.notes || "";
  document.getElementById("cf_cancel").style.display = "inline-flex";
}

function deleteClient_UI(id) {
  if (!confirm("Delete this client?")) return;
  deleteClient(id);
  toast("Deleted", "Client removed");
  renderClients();
}

function hookClientForm() {
  const form = document.getElementById("clientForm");
  const cancel = document.getElementById("cf_cancel");
  cancel.onclick = startAddClient;

  form.onsubmit = (e) => {
    e.preventDefault();
    const id = safeInt(document.getElementById("cf_id").value, 0);
    const name = document.getElementById("cf_name").value.trim();
    const email = document.getElementById("cf_email").value.trim();
    const phone = document.getElementById("cf_phone").value.trim();
    const address = document.getElementById("cf_address").value.trim();
    const notes = document.getElementById("cf_notes").value.trim();

    if (!name) {
      toast("Error", "Client name required");
      return;
    }

    if (id) {
      updateClient(id, {
        client_name: name,
        email: email || null,
        phone: phone || null,
        address: address || null,
        notes: notes || null
      });
      toast("Updated", "Client saved");
    } else {
      addClient({
        client_name: name,
        email: email || null,
        phone: phone || null,
        address: address || null,
        notes: notes || null
      });
      toast("Created", "New client added");
    }

    renderClients();
    setTimeout(startAddClient, 50);
  };
}

function renderVendors() {
  setPage("Vendors", "Manage your suppliers");
  const vendors = getVendors();

  viewEl.innerHTML = `
    <div class="grid">
      <div class="card">
        <div class="hd">
          <div>
            <h3>All Vendors</h3>
            <div class="sub">${vendors.length} vendors</div>
          </div>
          <button class="btn primary mini" id="addVendorBtn">+ Add Vendor</button>
        </div>
        <div class="bd">
          ${vendors.length ? `
            <table>
              <thead>
                <tr>
                  <th>Name</th>
                  <th>Contact</th>
                  <th class="right">Actions</th>
                </tr>
              </thead>
              <tbody>
                ${vendors.map(v => `
                  <tr>
                    <td>
                      <div style="font-weight:800">${esc(v.vendor_name)}</div>
                      <div class="muted" style="font-size:12px">${esc(v.notes || "")}</div>
                    </td>
                    <td class="muted">
                      ${v.email ? esc(v.email) : ""}
                      ${v.phone ? " ‚Ä¢ " + esc(v.phone) : ""}
                    </td>
                    <td class="right">
                      <div class="row-actions">
                        <button class="btn mini" onclick="editVendor(${v.vendor_id})">Edit</button>
                        <button class="btn mini danger" onclick="deleteVendor_UI(${v.vendor_id})">Delete</button>
                      </div>
                    </td>
                  </tr>
                `).join("")}
              </tbody>
            </table>
          ` : `<div class="empty">No vendors yet</div>`}
        </div>
      </div>

      <div class="card">
        <div class="hd">
          <h3 id="vendorFormTitle">Add Vendor</h3>
        </div>
        <div class="bd">
          <form id="vendorForm">
            <input type="hidden" id="vf_id" />
            <div class="field">
              <label>Vendor Name *</label>
              <input id="vf_name" required placeholder="e.g., Supply Co." />
            </div>
            <div class="two-col">
              <div class="field">
                <label>Email</label>
                <input id="vf_email" type="email" placeholder="sales@supplier.com" />
              </div>
              <div class="field">
                <label>Phone</label>
                <input id="vf_phone" placeholder="+31 20 987 6543" />
              </div>
            </div>
            <div class="field">
              <label>Address</label>
              <input id="vf_address" placeholder="Street, City, Country" />
            </div>
            <div class="field">
              <label>Notes</label>
              <textarea id="vf_notes" placeholder="Optional notes"></textarea>
            </div>
            
            <div class="split" style="justify-content:flex-end; margin-top:10px;">
              <button type="button" class="btn ghost" id="vf_cancel" style="display:none;">Cancel</button>
              <button class="btn primary" type="submit">Save Vendor</button>
            </div>
          </form>
        </div>
      </div>
    </div>
  `;

  document.getElementById("addVendorBtn").onclick = startAddVendor;
  hookVendorForm();
}

function startAddVendor() {
  document.getElementById("vendorFormTitle").textContent = "Add Vendor";
  document.getElementById("vf_id").value = "";
  document.getElementById("vf_name").value = "";
  document.getElementById("vf_email").value = "";
  document.getElementById("vf_phone").value = "";
  document.getElementById("vf_address").value = "";
  document.getElementById("vf_notes").value = "";
  document.getElementById("vf_cancel").style.display = "none";
}

function editVendor(id) {
  const vendor = getVendorById(id);
  if (!vendor) return;
  document.getElementById("vendorFormTitle").textContent = "Edit Vendor";
  document.getElementById("vf_id").value = vendor.vendor_id;
  document.getElementById("vf_name").value = vendor.vendor_name;
  document.getElementById("vf_email").value = vendor.email || "";
  document.getElementById("vf_phone").value = vendor.phone || "";
  document.getElementById("vf_address").value = vendor.address || "";
  document.getElementById("vf_notes").value = vendor.notes || "";
  document.getElementById("vf_cancel").style.display = "inline-flex";
}

function deleteVendor_UI(id) {
  if (!confirm("Delete this vendor?")) return;
  deleteVendor(id);
  toast("Deleted", "Vendor removed");
  renderVendors();
}

function hookVendorForm() {
  const form = document.getElementById("vendorForm");
  const cancel = document.getElementById("vf_cancel");
  cancel.onclick = startAddVendor;

  form.onsubmit = (e) => {
    e.preventDefault();
    const id = safeInt(document.getElementById("vf_id").value, 0);
    const name = document.getElementById("vf_name").value.trim();
    const email = document.getElementById("vf_email").value.trim();
    const phone = document.getElementById("vf_phone").value.trim();
    const address = document.getElementById("vf_address").value.trim();
    const notes = document.getElementById("vf_notes").value.trim();

    if (!name) {
      toast("Error", "Vendor name required");
      return;
    }

    if (id) {
      updateVendor(id, {
        vendor_name: name,
        email: email || null,
        phone: phone || null,
        address: address || null,
        notes: notes || null
      });
      toast("Updated", "Vendor saved");
    } else {
      addVendor({
        vendor_name: name,
        email: email || null,
        phone: phone || null,
        address: address || null,
        notes: notes || null
      });
      toast("Created", "New vendor added");
    }

    renderVendors();
    setTimeout(startAddVendor, 50);
  };
}

function renderSupply() {
  setPage("Supply Orders", "Receive stock from vendors");
  
  const orders = getSupplyOrders();
  const vendors = getVendors();
  const inventory = getInventory();

  viewEl.innerHTML = `
    <div class="grid">
      <div class="card">
        <div class="hd">
          <div>
            <h3>Create Supply Order</h3>
            <div class="sub">Increases inventory</div>
          </div>
          <span class="badge">‚¨áÔ∏è Receipt</span>
        </div>
        <div class="bd">
          <form id="supplyForm">
            <div class="field">
              <label>Vendor (optional)</label>
              <select id="so_vendor">
                <option value="">‚Äî No vendor ‚Äî</option>
                ${vendors.map(v => `<option value="${v.vendor_id}">${esc(v.vendor_name)}</option>`).join("")}
              </select>
            </div>
            <div class="field">
              <label>Notes</label>
              <input id="so_notes" placeholder="e.g., Weekly delivery" />
            </div>

            <div class="hr"></div>
            <h4 style="margin:8px 0;font-size:13px;">Line Items</h4>
            
            <div class="line-items" id="supplyLines"></div>
            
            <div class="split" style="margin-top:10px;">
              <button type="button" class="btn" id="addSupplyLineBtn">+ Add Line</button>
              <button class="btn primary" type="submit">Create Order</button>
            </div>
          </form>
        </div>
      </div>

      <div class="card">
        <div class="hd">
          <div>
            <h3>Recent Supply Orders</h3>
            <div class="sub">${orders.length} orders</div>
          </div>
        </div>
        <div class="bd">
          ${orders.length ? `
            <table>
              <thead>
                <tr>
                  <th>Date</th>
                  <th>Vendor</th>
                  <th>Notes</th>
                </tr>
              </thead>
              <tbody>
                ${orders.slice(0, 10).map(o => {
                  const vendor = o.vendor_id ? getVendorById(o.vendor_id) : null;
                  return `
                    <tr>
                      <td class="muted" style="font-size:11px">${formatWhen(o.order_date)}</td>
                      <td>${vendor ? esc(vendor.vendor_name) : "‚Äî"}</td>
                      <td class="muted">${esc(o.notes || "")}</td>
                    </tr>
                  `;
                }).join("")}
              </tbody>
            </table>
          ` : `<div class="empty">No supply orders yet</div>`}
        </div>
      </div>
    </div>
  `;

  const supplyLines = [];
  const linesEl = document.getElementById("supplyLines");
  
  function addSupplyLine() {
    const lineId = Date.now() + Math.random();
    supplyLines.push(lineId);
    
    linesEl.insertAdjacentHTML("beforeend", `
      <div class="li" data-line="${lineId}">
        <div class="field">
          <label>Item</label>
          <select class="so_item">
            ${inventory.map(i => `<option value="${i.item_id}">${esc(i.item_name)}</option>`).join("")}
          </select>
        </div>
        <div class="field">
          <label>Quantity</label>
          <input class="so_qty" type="number" min="1" step="1" value="1" />
        </div>
        <div class="field">
          <label>Cost Price</label>
          <input class="so_cost" type="number" min="0" step="0.01" placeholder="5.00" />
        </div>
        <div class="remove">
          <button type="button" class="btn mini danger so_remove">Remove</button>
        </div>
      </div>
    `);
    
    linesEl.querySelector(`[data-line="${lineId}"] .so_remove`).onclick = () => {
      const idx = supplyLines.indexOf(lineId);
      if (idx >= 0) supplyLines.splice(idx, 1);
      linesEl.querySelector(`[data-line="${lineId}"]`).remove();
    };
  }

  document.getElementById("addSupplyLineBtn").onclick = addSupplyLine;
  
  document.getElementById("supplyForm").onsubmit = (e) => {
    e.preventDefault();
    
    const vendorId = safeInt(document.getElementById("so_vendor").value, 0) || null;
    const notes = document.getElementById("so_notes").value.trim();
    
    const items = [];
    for (const lineId of supplyLines) {
      const el = linesEl.querySelector(`[data-line="${lineId}"]`);
      if (!el) continue;
      
      const itemId = safeInt(el.querySelector(".so_item").value, 0);
      const qty = safeInt(el.querySelector(".so_qty").value, 0);
      const cost = safeFloat(el.querySelector(".so_cost").value, 0);
      
      if (itemId && qty > 0 && cost > 0) {
        items.push({ item_id: itemId, quantity: qty, cost_price: cost, notes: null });
      }
    }
    
    if (items.length === 0) {
      toast("Error", "Add at least one line item");
      return;
    }
    
    createSupplyOrder({ vendor_id: vendorId, notes: notes || null, items });
    toast("Created", "Supply order added, inventory updated");
    renderSupply();
  };
  
  if (inventory.length) addSupplyLine();
}

function renderSales() {
  setPage("Sales", "Create sales transactions");
  
  const sales = getSales();
  const clients = getClients();
  const inventory = getInventory();

  viewEl.innerHTML = `
    <div class="grid">
      <div class="card">
        <div class="hd">
          <div>
            <h3>Create Sale</h3>
            <div class="sub">Decreases inventory</div>
          </div>
          <span class="badge">‚¨ÜÔ∏è Sale</span>
        </div>
        <div class="bd">
          <form id="saleForm">
            <div class="field">
              <label>Client (optional)</label>
              <select id="s_client">
                <option value="">‚Äî Walk-in customer ‚Äî</option>
                ${clients.map(c => `<option value="${c.client_id}">${esc(c.client_name)}</option>`).join("")}
              </select>
            </div>
            <div class="field">
              <label>Notes</label>
              <input id="s_notes" placeholder="e.g., Cash sale" />
            </div>

            <div class="hr"></div>
            <h4 style="margin:8px 0;font-size:13px;">Line Items</h4>
            
            <div class="line-items" id="saleLines"></div>
            
            <div class="split" style="margin-top:10px;">
              <button type="button" class="btn" id="addSaleLineBtn">+ Add Line</button>
              <button class="btn primary" type="submit">Create Sale</button>
            </div>
          </form>
        </div>
      </div>

      <div class="card">
        <div class="hd">
          <div>
            <h3>Recent Sales</h3>
            <div class="sub">${sales.length} sales</div>
          </div>
        </div>
        <div class="bd">
          ${sales.length ? `
            <table>
              <thead>
                <tr>
                  <th>Date</th>
                  <th>Client</th>
                  <th>Notes</th>
                </tr>
              </thead>
              <tbody>
                ${sales.slice(0, 10).map(s => {
                  const client = s.client_id ? getClientById(s.client_id) : null;
                  return `
                    <tr>
                      <td class="muted" style="font-size:11px">${formatWhen(s.sale_date)}</td>
                      <td>${client ? esc(client.client_name) : "Walk-in"}</td>
                      <td class="muted">${esc(s.notes || "")}</td>
                    </tr>
                  `;
                }).join("")}
              </tbody>
            </table>
          ` : `<div class="empty">No sales yet</div>`}
        </div>
      </div>
    </div>
  `;

  const saleLines = [];
  const linesEl = document.getElementById("saleLines");
  
  function addSaleLine() {
    const lineId = Date.now() + Math.random();
    saleLines.push(lineId);
    
    linesEl.insertAdjacentHTML("beforeend", `
      <div class="li" data-line="${lineId}">
        <div class="field">
          <label>Item</label>
          <select class="s_item">
            ${inventory.map(i => `<option value="${i.item_id}">${esc(i.item_name)} (stock: ${i.quantity})</option>`).join("")}
          </select>
        </div>
        <div class="field">
          <label>Quantity</label>
          <input class="s_qty" type="number" min="1" step="1" value="1" />
        </div>
        <div class="field">
          <label>Unit Price</label>
          <input class="s_price" type="number" min="0" step="0.01" placeholder="12.50" />
        </div>
        <div class="remove">
          <button type="button" class="btn mini danger s_remove">Remove</button>
        </div>
      </div>
    `);
    
    linesEl.querySelector(`[data-line="${lineId}"] .s_remove`).onclick = () => {
      const idx = saleLines.indexOf(lineId);
      if (idx >= 0) saleLines.splice(idx, 1);
      linesEl.querySelector(`[data-line="${lineId}"]`).remove();
    };
    
    // Auto-fill price from inventory
    const itemSelect = linesEl.querySelector(`[data-line="${lineId}"] .s_item`);
    const priceInput = linesEl.querySelector(`[data-line="${lineId}"] .s_price`);
    itemSelect.onchange = () => {
      const itemId = safeInt(itemSelect.value, 0);
      const item = getInventoryById(itemId);
      if (item) priceInput.value = item.unit_price;
    };
    if (inventory.length) itemSelect.onchange();
  }

  document.getElementById("addSaleLineBtn").onclick = addSaleLine;
  
  document.getElementById("saleForm").onsubmit = (e) => {
    e.preventDefault();
    
    const clientId = safeInt(document.getElementById("s_client").value, 0) || null;
    const notes = document.getElementById("s_notes").value.trim();
    
    const items = [];
    for (const lineId of saleLines) {
      const el = linesEl.querySelector(`[data-line="${lineId}"]`);
      if (!el) continue;
      
      const itemId = safeInt(el.querySelector(".s_item").value, 0);
      const qty = safeInt(el.querySelector(".s_qty").value, 0);
      const price = safeFloat(el.querySelector(".s_price").value, 0);
      
      if (itemId && qty > 0 && price > 0) {
        items.push({ item_id: itemId, quantity: qty, unit_price: price, notes: null });
      }
    }
    
    if (items.length === 0) {
      toast("Error", "Add at least one line item");
      return;
    }
    
    try {
      createSale({ client_id: clientId, notes: notes || null, items });
      toast("Created", "Sale completed, inventory updated");
      renderSales();
    } catch (err) {
      toast("Error", err.message);
    }
  };
  
  if (inventory.length) addSaleLine();
}

function renderReports() {
  setPage("Reports", "Sales and inventory analytics");
  
  const totalValue = DB.inventory.reduce((sum, i) => sum + (i.quantity * i.unit_price), 0);
  const totalItems = DB.inventory.reduce((sum, i) => sum + i.quantity, 0);
  
  const totalSales = DB.sale_items.reduce((sum, si) => sum + (si.quantity * si.unit_price), 0);
  const totalSupplyCost = DB.supply_items.reduce((sum, si) => sum + (si.quantity * si.cost_price), 0);
  
  viewEl.innerHTML = `
    <div class="grid">
      <div class="card">
        <div class="hd">
          <div>
            <h3>Inventory Summary</h3>
            <div class="sub">Current stock metrics</div>
          </div>
        </div>
        <div class="bd">
          <div class="kpi-row" style="grid-template-columns:1fr 1fr">
            <div class="kpi">
              <div class="label">Total Inventory Value</div>
              <div class="value">‚Ç¨${money(totalValue)}</div>
            </div>
            <div class="kpi">
              <div class="label">Total Units</div>
              <div class="value">${totalItems}</div>
            </div>
          </div>
        </div>
      </div>

      <div class="card">
        <div class="hd">
          <div>
            <h3>Transaction Summary</h3>
            <div class="sub">All-time totals</div>
          </div>
        </div>
        <div class="bd">
          <div class="kpi-row" style="grid-template-columns:1fr 1fr">
            <div class="kpi">
              <div class="label">Total Sales Revenue</div>
              <div class="value">‚Ç¨${money(totalSales)}</div>
              <div class="hint">${DB.sales.length} transactions</div>
            </div>
            <div class="kpi">
              <div class="label">Total Supply Cost</div>
              <div class="value">‚Ç¨${money(totalSupplyCost)}</div>
              <div class="hint">${DB.supply_orders.length} orders</div>
            </div>
          </div>
          
          <div class="hr"></div>
          
          <div class="kpi">
            <div class="label">Gross Margin (Est.)</div>
            <div class="value">‚Ç¨${money(totalSales - totalSupplyCost)}</div>
            <div class="hint">Sales revenue minus supply costs</div>
          </div>
        </div>
      </div>
    </div>
  `;
}

// ===================================================================
// NAVIGATION
// ===================================================================

let currentView = "dashboard";

function goto(view) {
  currentView = view;
  setActiveNav(view);

  const searchVal = document.getElementById("globalSearch").value || "";
  
  if (view === "dashboard") renderDashboard();
  else if (view === "inventory") renderInventory(searchVal);
  else if (view === "clients") renderClients();
  else if (view === "vendors") renderVendors();
  else if (view === "supply") renderSupply();
  else if (view === "sales") renderSales();
  else if (view === "reports") renderReports();
}

function setActiveNav(view) {
  document.querySelectorAll("#nav button").forEach(b => {
    b.classList.toggle("active", b.dataset.view === view);
  });
}

document.getElementById("nav").addEventListener("click", (e) => {
  const btn = e.target.closest("button[data-view]");
  if (!btn) return;
  goto(btn.dataset.view);
});

document.getElementById("globalSearch").addEventListener("input", (e) => {
  const val = e.target.value;
  if (currentView === "inventory") renderInventory(val);
});

// ===================================================================
// SEED & RESET
// ===================================================================

document.getElementById("seedBtn").onclick = () => {
  if (DB.inventory.length && !confirm("This will add demo data. Continue?")) return;
  
  // Add demo inventory
  addInventoryItem({ item_name: "Coffee Beans 1kg", description: "Arabica blend", quantity: 0, unit_price: 19.50, reorder_level: 5, notes: null });
  addInventoryItem({ item_name: "Sugar 1kg", description: "White sugar", quantity: 0, unit_price: 2.40, reorder_level: 10, notes: null });
  addInventoryItem({ item_name: "Milk 1L", description: "Fresh milk", quantity: 0, unit_price: 1.60, reorder_level: 20, notes: null });
  
  // Add demo clients
  addClient({ client_name: "Caf√© Central", email: "cafe@central.com", phone: "+31 20 123 4567", address: "Amsterdam", notes: null });
  addClient({ client_name: "Bakery Bliss", email: "info@bakery.com", phone: "+31 20 987 6543", address: "Rotterdam", notes: null });
  
  // Add demo vendors
  addVendor({ vendor_name: "Global Coffee Supply", email: "sales@globalcoffee.com", phone: "+31 20 111 2222", address: "Utrecht", notes: null });
  
  toast("Loaded", "Demo data added");
  goto("dashboard");
};

document.getElementById("resetBtn").onclick = () => {
  if (!confirm("This will delete ALL data. Continue?")) return;
  
  DB.inventory = [];
  DB.clients = [];
  DB.vendors = [];
  DB.sales = [];
  DB.sale_items = [];
  DB.supply_orders = [];
  DB.supply_items = [];
  
  nextId = {
    item: 1,
    client: 1,
    vendor: 1,
    sale: 1,
    sale_item: 1,
    supply_order: 1,
    supply_item: 1
  };
  
  toast("Reset", "All data cleared");
  goto("dashboard");
};

// ===================================================================
// INITIALIZE
// ===================================================================

function init() {
  goto("dashboard");
}

init();
</script>
</body>
</html>
